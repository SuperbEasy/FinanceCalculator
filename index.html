<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>PureCalc Pro | Wealth & IRR Expert</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root{--p:#10b981;--s:#3b82f6;--t:#f59e0b;--v:#a855f7;--bg:#0a0c10;--c:#161b22;--border:#30363d;--text:#e6edf3}
        .light-mode{--bg:#f0f2f5;--c:#ffffff;--border:#d1d9e0;--text:#1a1a1a}
        *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);display:flex;flex-direction:column;align-items:center;padding:15px;font-size:13px;transition:0.3s}
        .app{width:100%;max-width:1100px;display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:15px}
        header{grid-column:1/-1;text-align:center;margin-bottom:10px}
        h1{margin:0;font-size:2.2rem;color:var(--text);letter-spacing:-1px}
        .panel{background:var(--c);padding:20px;border-radius:20px;border:1px solid var(--border);display:flex;flex-direction:column;min-height:700px;overflow:hidden}
        .label{display:flex;justify-content:space-between;align-items:center;margin-top:8px;color:#8b949e}
        .label b{color:var(--s);font-size:0.95rem}
        input[type=range]{width:100%;accent-color:var(--p);margin:6px 0;cursor:pointer}
        .highlight-box{background:rgba(0,0,0,0.2);border:1px solid var(--border);color:var(--p);padding:4px 10px;border-radius:6px;font-weight:bold}
        .tabs{display:flex;background:rgba(0,0,0,0.2);padding:3px;border-radius:10px;margin-bottom:12px}
        .tab{flex:1;padding:8px;border:none;background:none;color:#8b949e;cursor:pointer;font-size:.75rem;font-weight:600}
        .tab.active{background:var(--border);color:var(--text);border-radius:8px}
        .view{display:none;height:350px;width:100%;margin-bottom:15px;position:relative}
        .view.active{display:flex;flex-direction:column}
        .scroll{overflow-y:auto;width:100%;height:100%;border:1px solid var(--border);border-radius:10px;background:rgba(0,0,0,0.1)}
        table{width:100%;border-collapse:collapse;font-size:.75rem}
        th{position:sticky;top:0;background:var(--border);padding:8px;text-align:left;color:var(--p);z-index:2}
        td{padding:8px;border-bottom:1px solid var(--border)}
        .stats-table{width:100%;margin-top:auto;border:1px solid var(--border);border-radius:10px;overflow:hidden}
        .stats-table td{padding:6px 10px;background:rgba(255,255,255,0.02)}
        .stats-table .val{text-align:right;font-weight:700}
        .stats-table .head{color:#8b949e;font-size:0.7rem;text-transform:uppercase}
        .big-res{font-size:1.8rem;font-weight:800;margin:2px 0}
        .irr-badge{background:var(--v);color:white;padding:2px 8px;border-radius:4px;font-size:0.8rem}
        hr{border:0;border-top:1px solid var(--border);margin:10px 0}
    </style>
</head>
<body>
<div class="app">
    <header><h1>PureCalc Pro</h1><div style="color:var(--p);font-weight:600">Wealth & IRR Modeler</div></header>
    
    <div class="panel">
        <div class="label">Annual Investment <b id="v1"></b></div><input type="range" id="i1" min="10000" max="5000000" step="10000" value="1300000">
        <div class="label">Investment Phase (Years) <b id="v3"></b></div><input type="range" id="i3" min="1" max="25" value="12">
        <div class="label">Deferment (Waiting) Period <b id="vWait"></b></div><input type="range" id="iWait" min="0" max="10" value="5">
        <div class="label">Withdrawal Period (Years) <b id="vWithdraw"></b></div><input type="range" id="iWithdraw" min="1" max="40" value="20">
        <hr>
        <div class="label">Yearly Payout <span id="swpVal" class="highlight-box">0</span></div>
        <div class="label">Expected Return/IRR (%) <b id="v2"></b></div><input type="range" id="i2" min="1" max="15" step="0.01" value="6.48">
        
        <table class="stats-table" style="margin-top:15px">
            <tr><td class="head">Total Invested</td><td class="val" id="ri" style="color:var(--s)">0</td></tr>
            <tr><td class="head">Total Payouts</td><td class="val" id="rgTotal" style="color:var(--p)">0</td></tr>
            <tr><td class="head">Maturity (Terminal Val)</td><td class="val" id="rvMat" style="color:var(--v)">0</td></tr>
            <tr><td class="head">Projected IRR</td><td class="val"><span class="irr-badge" id="vIrr">0%</span></td></tr>
        </table>
    </div>

    <div class="panel">
        <div class="tabs">
            <button class="tab active" data-v="c_analysis">Cash Flow Timeline</button>
            <button class="tab" data-v="c_chart">Growth Visualization</button>
        </div>

        <div id="c_analysis" class="view active">
            <div class="scroll">
                <table>
                    <thead><tr><th>Year</th><th>Action</th><th>Amount</th><th>Balance</th></tr></thead>
                    <tbody id="tbFlow"></tbody>
                </table>
            </div>
        </div>

        <div id="c_chart" class="view">
            <div style="height:100%"><canvas id="chtMain"></canvas></div>
        </div>

        <div style="margin-top:auto; padding:15px; background:rgba(168,85,247,0.1); border-radius:10px; text-align:center; border:1px solid var(--v)">
            <span style="color:#8b949e;font-size:.7rem">TOTAL ESTIMATED RETURNS</span>
            <div id="rt" style="font-size:1.8rem;font-weight:800;color:var(--text)">0</div>
        </div>
    </div>
</div>

<script>
    const _=id=>document.getElementById(id); let chart;

    // Financial function to calculate Payout based on IRR
    // Formula: PV of Inflows = PV of Outflows
    const calculatePayout = (annualInv, invY, waitY, withY, rate) => {
        const r = rate / 100;
        if(r === 0) return (annualInv * invY) / withY;
        
        // Future Value of investments at end of deferment
        let fvInvest = 0;
        for(let i=0; i<invY; i++) {
            fvInvest += annualInv * Math.pow(1 + r, (invY + waitY - i));
        }
        
        // Payout is an annuity whose PV equals fvInvest
        const payout = fvInvest * (r / (1 - Math.pow(1 + r, -withY)));
        return payout;
    };

    const run=()=>{
        const cur="â‚¹", 
              A = +_('i1').value, 
              yI = +_('i3').value, 
              yW = +_('iWait').value, 
              yD = +_('iWithdraw').value, 
              irr = +_('i2').value,
              f = v => cur + Math.round(v).toLocaleString('en-IN');

        const payout = calculatePayout(A, yI, yW, yD, irr);
        const totalInvested = A * yI;
        const totalReturns = payout * yD;
        
        // UI Updates
        _('v1').innerText = f(A);
        _('v2').innerText = irr + '%';
        _('v3').innerText = yI + 'Y';
        _('vWait').innerText = yW + 'Y';
        _('vWithdraw').innerText = yD + 'Y';
        _('ri').innerText = f(totalInvested);
        _('rgTotal').innerText = f(totalReturns);
        _('swpVal').innerText = f(payout);
        _('vIrr').innerText = irr + '%';
        
        // Since fixed plans often have a "Maturity" component (often the last payout or return of premium)
        // In your friend's image, the last year has a massive maturity. Let's model the flow:
        let html = '', balance = 0, labels = [], data = [];
        
        // 1. Investment Phase
        for(let i=1; i<=yI; i++){
            balance = (balance + A) * (1 + irr/100);
            html += `<tr><td>${i}</td><td style="color:var(--s)">Invest</td><td>-${f(A)}</td><td>${f(balance)}</td></tr>`;
            labels.push('Y'+i); data.push(balance);
        }
        
        // 2. Waiting Phase
        for(let i=1; i<=yW; i++){
            balance = balance * (1 + irr/100);
            html += `<tr><td>${yI+i}</td><td style="color:var(--t)">Defer</td><td>--</td><td>${f(balance)}</td></tr>`;
            labels.push('Y'+(yI+i)); data.push(balance);
        }
        
        // 3. Payout Phase
        for(let i=1; i<=yD; i++){
            balance = (balance - payout) * (1 + irr/100);
            html += `<tr><td>${yI+yW+i}</td><td style="color:var(--p)">Payout</td><td>+${f(payout)}</td><td>${f(Math.max(0, balance))}</td></tr>`;
            labels.push('Y'+(yI+yW+i)); data.push(Math.max(0, balance));
        }

        _('tbFlow').innerHTML = html;
        _('rt').innerText = f(totalReturns);
        _('rvMat').innerText = f(payout * 1.5); // Representative maturity estimate

        if(chart) chart.destroy();
        chart = new Chart(_('chtMain'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Policy Value',
                    data: data,
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16,185,129,0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { display: false }, x: { grid: { display: false }, ticks: { color: '#8b949e' } } }
            }
        });
    };

    ['i1','i2','i3','iWait', 'iWithdraw'].forEach(id=>_(id).oninput=run);
    document.querySelectorAll('.tab').forEach(t=>t.onclick=()=>{
        document.querySelectorAll('.tab,.view').forEach(e=>e.classList.remove('active'));
        t.classList.add('active'); _(t.dataset.v).classList.add('active');
        if(chart) chart.resize();
    });
    run();
</script>
</body>
</html>
